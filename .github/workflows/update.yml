name: 'Smash League | Scheduled'

on: push

jobs:

  commit:
    name: Update version & tags
    runs-on: ubuntu-latest

    # if: github.ref == 'refs/heads/master' && github.repository == 'Xotl/Smash-League'

    env: 
      REMOTE_REPO: https://${{ secrets.GITHUB_OAUTH_TOKEN }}@github.com/${{ github.repository }}.git
      REMOTE_REF: ${{ github.ref }}
      WIT_TOKEN: ${{ secrets.WIT_TOKEN }}
      SLACK_API_TOKEN:  ${{ secrets.SLACK_API_TOKEN }}

    steps:
      - uses: actions/checkout@v1

      - name: Update version
        run: |
          npm version | grep "smash-league" | cut -d ':' -f2 | cut -d \' -f2
          npm --no-git-tag-version version minor
          npm version | grep "smash-league" | cut -d ':' -f2 | cut -d \' -f2


      - name: Confirm stuff
        run: npm version | grep "smash-league" | cut -d ':' -f2 | cut -d \' -f2

      # - name: Update repo
      #   run: |
      #     NEW_VERSION=$(npm version | grep "smash-league" | cut -d ':' -f2 | cut -d \' -f2)
      #     git config user.name "github"
      #     git config user.email "github@users.noreply.github.com"
      #     git add .
      #     git commit -m "v${NEW_VERSION} | Auto pushed from Github Actions"
      #     git tag -a "v${NEW_VERSION}" -m "v${NEW_VERSION} | Auto pushed from Github Actions"
      #     git push --follow-tags ${REMOTE_REPO} HEAD:${REMOTE_REF}

      # - name: Build the Docker image
      #   run: docker build . --file Dockerfile --build-arg --tag smash-league

      # - name: Notify
      #   run: >-
      #     docker run
      #     --rm
      #     --name smash-league-tests
      #     -v ranking-info:/usr/app/ranking-info
      #     -v src:/usr/app/src
      #     -e TRAVIS_EVENT_TYPE="push"
      #     -e TRAVIS_BRANCH="master"
      #     -e CI=true
      #     smash-league
      #     npm run start:smash-league
